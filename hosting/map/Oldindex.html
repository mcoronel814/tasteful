<!DOCTYPE html>
<html lang="en">
  <head>
    <title>FOOD MAP</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- font awesome -->
    <script
      src="https://kit.fontawesome.com/31149d48b0.js"
      crossorigin="anonymous"
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- font Caprasimo -->
    <link
      href="https://fonts.googleapis.com/css2?family=Caprasimo&display=swap"
      rel="stylesheet"
    />

    <!-- font League Spartan -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@800&display=swap"
      rel="stylesheet"
    />

    <!-- font RM sans -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@500&display=swap"
      rel="stylesheet"
    />

    <!-- font bebas neue -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <!-- linking script file -->
    <script type="module" src="./map.js"></script>
  </head>

  <body id="beige">
    <nav class="navbar navbar-expand-lg navbarScroll">
      <div class="container">
        <a class="navbar-brand" href="https://tasteful-48763.web.app/">
          <p id="foodExplorer">
            Food <br />
            Explorer
          </p>
        </a>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">
                <button type="button" id="lightBlue" class="button">MAP</button>
              </a>
            </li>

            <li class="nav-item">
              <a
                class="nav-link"
                href="https://tasteful-48763.web.app/cookbook"
              >
                <button type="button" id="darkBlue" class="button">
                  COOKBOOK
                </button>
              </a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="https://tasteful-48763.web.app/aboutus">
                <button type="button" id="lightPink" class="button">
                  ABOUT US
                </button>
              </a>
            </li>
          </ul>

          <span id="user-name"></span>
          <img id="user-photo" src="" alt="User photo" />
          <button id="sign-in-button">Sign in with Google</button>
          <button id="sign-out-button">Sign out</button>
          
        </div>
      </div>
    </nav>

    <main class="container mt-4">
      <h2 class="mb-4" id="us2">Select a Location</h2>
      <form id="location-form" class="d-flex">
        <input
          type="text"
          id="location-input"
          class="form-control me-2"
          placeholder="Enter a location"
        />
        <button type="submit" class="btn btn-primary">Search</button>
      </form>

      <div id="map"></div>

      <div id="restaurant-list" class="row mt-4">
        <!-- Restaurants will be dynamically added here -->

        <img class="ml-3" src="./map.png" alt="map picture" id="map" />
      </div>
    </main>

    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <br />
    <br />
    <br />
    <br />
    <br />
    <br />

    <div class="fakeBg">
      <div class="container text-center">
        <div class="row">
          <div class="col">
            <img
              class="ml-3"
              src="./guyTyping.png"
              alt="Guy Typing"
              id="guyPicture"
            />
            <!-- <p>&copy; 2023 Tasteful@Team18. All rights reserved.</p>  -->
          </div>

          <div class="col">
            <h1 id="us">Contact Us</h1>
            <input type="text" placeholder="Name.." id="iputName" />
            <br />
            <br />
            <br />
            <input type="text" placeholder="Email.." id="inputEmail" />
            <br />
            <br />
            <br />
          </div>

          <div class="col">
            <br />
            <br />

            <input type="text" placeholder="Inquiry.." id="inputInquiry" />
          </div>
        </div>

        <div class="row">
          <button type="button" class="button" id="bu2">SUBMIT</button>
        </div>
      </div>
    </div>

    <!-- class="bg-dark text-light py-3" -->
    <footer id="footcolor">
      <p>&copy; 2023 Tasteful@Team18. All rights reserved.</p>
    </footer>

    <script>
      let map;
      let infoWindow;
      let markers = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 0, lng: 0 },
          zoom: 15,
        });

        infoWindow = new google.maps.InfoWindow();

        const locationForm = document.getElementById("location-form");
        locationForm.addEventListener("submit", searchPlaces);
        getCurrentLocation();

        const locationInput = document.getElementById("location-input");
        const autocomplete = new google.maps.places.Autocomplete(locationInput);
        autocomplete.addListener("place_changed", () => {
          const place = autocomplete.getPlace();
          if (!place.geometry || place.types.indexOf("restaurant") === -1) {
            alert("Please enter a valid restaurant location.");
            return;
          }
          clearMarkers();
          showPlaceOnMap(place.geometry.location);
          map.setCenter(place.geometry.location);
          map.setZoom(15);
        });
      }

      function searchPlaces(event) {
        event.preventDefault();
        const locationInput = document.getElementById("location-input");
        const location = locationInput.value.trim();

        if (!location) {
          alert("Please enter a location.");
          return;
        }

        const service = new google.maps.places.PlacesService(map);
        service.textSearch(
          { query: location, type: "restaurant" },
          (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
              clearMarkers();
              showPlacesList(results);
            } else {
              alert("No restaurants found for the given location.");
            }
          }
        );
      }

      function showPlacesList(places) {
        const resultsContainer = document.getElementById("restaurant-list");
        resultsContainer.innerHTML = "";

        places.forEach((place) => {
          const name = place.name;
          const address = place.formatted_address;
          const rating = place.rating || "Not available";
          const website = place.website || "#";

          const resultElement = `
            <div class="col">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">${name}</h5>
                  <p class="card-text">${address}</p>
                  <p class="card-text">Rating: ${rating}</p>
                  <a href="${
                    website !== "#" ? website : "javascript:void(0)"
                  }" target="_blank" class="btn btn-primary visit-website-button" data-website="${website}">Visit Website</a>
                </div>
              </div>
            </div>
          `;

          resultsContainer.insertAdjacentHTML("beforeend", resultElement);

          const marker = new google.maps.Marker({
            map,
            position: place.geometry.location,
            title: name,
          });

          google.maps.event.addListener(marker, "click", () => {
            infoWindow.setContent(name);
            infoWindow.open(map, marker);
          });

          markers.push(marker);
        });

        // Add event listeners to the "Visit Website" buttons
        const visitWebsiteButtons = document.getElementsByClassName(
          "visit-website-button"
        );
        Array.from(visitWebsiteButtons).forEach((button) => {
          button.addEventListener("click", () => {
            const websiteURL = button.getAttribute("data-website");
            if (websiteURL && websiteURL !== "#") {
              window.open(websiteURL, "_blank");
            }
          });
        });
      }

      function showPlaceOnMap(location) {
        map.setCenter(location);

        const marker = new google.maps.Marker({
          map,
          position: location,
        });

        google.maps.event.addListener(marker, "click", () => {
          infoWindow.setContent("Your location");
          infoWindow.open(map, marker);
        });

        markers.push(marker);
      }

      function clearMarkers() {
        markers.forEach((marker) => marker.setMap(null));
        markers = [];
      }

      function getCurrentLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              const userLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };
              map.setCenter(userLocation);
              map.setZoom(15);

              const marker = new google.maps.Marker({
                map,
                title: "Your location",
                position: userLocation,
              });

              google.maps.event.addListener(marker, "click", () => {
                infoWindow.setContent("Your location");
                infoWindow.open(map, marker);
              });

              markers.push(marker);
            },
            () => {
              console.log("Error: The Geolocation service failed.");
            }
          );
        } else {
          console.log("Error: Your browser doesn't support geolocation.");
        }
      }
    </script>

    <!-- Load the Google Maps API with the Places library -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-a6jcC_IgUAGb7AVlKLWo0DOWOzK96zY&libraries=places&callback=initMap"
      async
      defer
    ></script>
  </body>
</html>
