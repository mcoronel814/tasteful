<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />

    <!-- <link rel="stylesheet" href="layout.css" />
    <link rel="stylesheet" href="placeInformation.css" /> -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@600&display=swap"
      rel="stylesheet"
    />
    <title>Knives, Out!</title>
  </head>
  <body>
    <div class="container-fluid text-center" id="displaEverything">
      <div class="row">
        <div class="col info1" id="blue1">
          <div class="container-fluid text-center" id="body1">
            <div class="row">
              <div class="col">
                <form action="">
                  <input type="search" id="searchBar" placeholder="   " />
                  <img src="search.png" alt="search" id="search" />
                </form>

                <br />
                <br />
                <br />
                <br />
                <br />
                <br />

                <h1 id="restaurantName"></h1>
                <br />

                <!-- <div id="starRate">  -->

                <h5 id="restaurantScore"></h5>

                <h5 id="restaurantType">
                  <br />
                </h5>

                <!-- stars -->
                <div class="image-container" id="imageContainer">

                  <img style="display: none;"    src="./star1.png" >
                  <img style="display: none;"    src="./link.png" >
                  <img style="display: none;"    src="./time.png" >
                  <img style="display: none;"    src="./placeholder.png" >

                </div>
                <br />
                <br />

                <!-- </div> -->
              </div>
            </div>

            <div class="row">
              <div class="col">
                <div id="myTopnav" class="topnav">
                  <a href="#" class="active" id="Overview">Overview</a>
                  <a href="#" id="reviews"> Reviews</a>
                </div>

                <hr id="greyLine" />
              </div>
            </div>

            <div class="row">
              <div class="col">
                <p id="describe">
                  Big Slices with creamy artichokes topping & other
                </p>

                <p id="describe1">
                  unique twist draw crowds to this casual pie spot.
                </p>

                <p id="describe2">Dine-in - Takeout - Delivery</p>

                <hr id="greyLine" />
                <br />
                <br />

                <img src="placeholder.png" alt="" id="pin" />
                <h5 id="address"></h5>

                <img src="link.png" alt="" id="link" />
                <h5 id="website"></h5>
                <!-- <a id="website" href="#" target="_blank"> Check Out Our Website!</a> -->

                <br />

                <img src="time.png" alt="" id="time" />

                <p id="OpeningHours"></p>

                <br />
                <br />
                <p></p>
              </div>
            </div>
          </div>
        </div>

        <div class="col" id="yellow1">
          <div class="container-fluid text-center" id="recipes">
            <!-- <div class="row" >

               <div class="col" >
                
                col

                <hr id="recipe1">
              
              </div>
            </div>

            <div class="row">
              <div class="col">
                
                col
                <hr id="recipe2">
              
              </div>
            </div>

            <div class="row">
              <div class="col">
                col
                <hr id="recipe3">
              </div>
            </div>

            <div class="row">
              <div class="col">
                
                col
                <hr id="recipe4">
              
              </div>
            </div>  -->
          </div>
        </div>

        <div class="col-6" id="map">
          <!-- -->

          <!-- 2 of 3 (wider)  -->
        </div>
      </div>

      <!-- <div class="row">
          <div class="col">
            1 of 3
          </div>
          <div class="col-5">
            2 of 3 (wider)
          </div>
          <div class="col">
            3 of 3
          </div>
        </div> -->
    </div>

    <!-- Google JavaScript -->

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCojeyZ3gqEIRutinm6DuOUvA9nrSiYSLQ&libraries=places&callback=initMap"
      async
      defer
    ></script>
    <!--  -->
    <!-- <script src="script2.js"></script>-->
    <!-- <script src="script3.js"></script> -->
    <!-- <script type="module" src="./script4.js"></script> -->
    <script type="module" src="./map.js"></script>
    <!-- linking script file -->
   <!-- linking script file -->

    <!-- <script src="script7.js"></script> -->
    <!-- <script src="meal.js"></script> -->
    <!-- <script src="star.js"></script> -->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <!-- <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script> -->




  </body>



  <script>


// script4a.js

const recipeContainer = document.getElementById('recipes');

// Fetch recipes from TheMealDB API
async function fetchRecipes() {





  const apiKey = '1';
  
  // Number of recipes to retrieve
  const numberOfRecipes = 3;


  try {
    const response = await fetch(`https://www.themealdb.com/api/json/v2/${apiKey}/randomselection.php`);
    const data = await response.json();

    const recipes = data.meals.slice(0, numberOfRecipes);
    displayRecipes(recipes);
  } catch (error) {
    console.error('Error fetching recipes:', error);
  }
}


// Display recipes in the HTML container
function displayRecipes(recipes) {
  recipeContainer.innerHTML = '';
  recipes.forEach(recipe => {
    const recipeCard = document.createElement('div');
    recipeCard.classList.add('col');

    // Truncate instructions to the first 100 words
    const truncatedInstructions = truncateText(recipe.strInstructions, 45);

    recipeCard.innerHTML = `
        <span class="hiddentxt">
            <h2 id="RecipeName" >${recipe.strMeal}</h2>
        </span>
        <span class="hiddenimg">
            <img src="${recipe.strMealThumb}" alt="${recipe.strMeal}" id="recipePic" >
            </span>
            <p id="instruction" >${truncatedInstructions}</p>
            <button id="btnRecipe" > 
            
            <a href="${recipe.strYoutube}" target="_blank"> Check Recipe </a>
            
            </button>
            <hr id="recipe1">


        `;

    recipeContainer.appendChild(recipeCard);
  });
}


//truncate text to a specified number of words
function truncateText(text, maxLength) {
  const words = text.split(' ');
  if (words.length > maxLength) {
    return words.slice(0, maxLength).join(' ') + '...';
  }
  return text;
}





//display the restaurant rating in number of stars

function stars(numberOfStars) {

  const container = document.getElementById("imageContainer");

  const imageWidth = 13;
  const imageHeight = 13;

  for (let i = 0; i < Math.round(numberOfStars); i++) {


    const imageBox = document.createElement("div");
    imageBox.className = "image-box";


    const image = document.createElement("img");
    image.src = "star1.png";
    image.alt = "Image " + (i + 1);
    image.style.width = imageWidth + "px";
    image.style.height = imageHeight + "px";

    imageBox.appendChild(image);
    container.appendChild(imageBox);


  }
}




//layout when user click on reviews
function newLayout(reviews, rating) {

  const body1 = document.getElementById("body1");


  body1.innerHTML = '';
  const rate1 = document.createElement('div');
  rate1.classList.add('note');
  rate1.innerHTML = `<h2 id="rate1" > ${rating} </h2>
     <div class="image-container" id="imageContainer">
     
     `


  body1.appendChild(rate1);

  for (let i = 0; i < 3; i++) {

    const author = reviews[i]['author_name'];
    const text = reviews[i]['text'];
    const rating = reviews[i]['rating'];
    const visited = reviews[i]['relative_time_description'];

    const reviewCard = document.createElement('div');
    reviewCard.classList.add('col');

    reviewCard.innerHTML =

      `
                <h2 id="author" > ${author} </h2>

        


               
                <p id="visited" > ${visited} </p>

       

                <p id="review" > ${text} </p>

                <hr id="greyLine">
                
                `


    body1.appendChild(reviewCard);
     
  }
}



//layout when the user click on the marker after clicking on reviews
function oldLayout() {
  const body1 = document.getElementById("body1");

  body1.innerHTML = '';
  const div = document.createElement('div');
  div.classList.add('row');
  div.innerHTML = `
  <div class="col">
  <form action="">
    <input type="search" id="searchBar" placeholder="   " />
    <img src="search.png" alt="search" id="search" />
  </form>

  <br />
  <br />
  <br />
  <br />
  <br />
  <br />

  <h1 id="restaurantName"></h1>
  <br />

  <!-- <div id="starRate">  -->

  <h5 id="restaurantScore"></h5>

  <h5 id="restaurantType">
    <br />
  </h5>

 
  <!-- stars -->
  <div class="image-container" id="imageContainer"></div>
  <br />
  <br />

  <!-- </div> -->

</div>
<div class="row">
  <div class="col">
  <div id="myTopnav" class="topnav">
  <a href="#" class="active" id="Overview">Overview</a>
  <a href="#" id="reviews"> Reviews</a>
</div>
 <hr class="greyLine" /> 
  </div>
</div>


<!--   -->

<div class="row">
  <div class="col">
    <p id="describeA">Big Slices with creamy artichokes topping & other</p>

    <p id="describeB">unique twist draw crowds to this casual pie spot.</p>

    <p id="describeC">Dine-in - Takeout - Delivery</p>

    <hr class="greyLine" />  

    <br />
    <br />

    <img src="/assets/placeholder-41d1ae94.png" alt="" id="pinA" />
    <h5 id="address"></h5>

    <img src="link.png" alt="" id="linkB" />
    <h5 id="website"></h5>

    <br />

    <img src="time.png" alt="" id="timeC" />

    <p id="OpeningHours"></p>

    <br />
    <br />
    <p></p>
  </div>
</div>

  
  `

  body1.appendChild(div);


}




//variables
const restaurants = [];
var reviewCount = 0;


//set map size the map size to plain screen in the begining
var map2 = document.getElementById("map");
map2.classList.remove("col-6")


//change info block display to none
var blue1 = document.getElementById("blue1");
blue1.style.display = "none";
var yellow1 = document.getElementById("yellow1");
yellow1.style.display = "none";


function initMap() {
  // const map = new google.maps.Map(document.getElementById("map"), {
  //   center: { lat: 40.7128, lng: -74.0060 },
  //   zoom: 15,
  // });

  // const userLocation = { lat: 40.7128, lng: -74.0060 };




  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      function (position) {
        // Retrieve latitude and longitude from the position object
        var userLat = position.coords.latitude;
        var userLng = position.coords.longitude;

        // Create a map centered on the user's location
        var map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: userLat, lng: userLng },
          zoom: 15
        });



        const userLocation = { lat: userLat, lng: userLng };







        const service = new google.maps.places.PlacesService(map);

        service.nearbySearch(
          {
            location: userLocation,
            radius: 5000,
            type: "restaurant",
          },
          async (results, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK) {
              for (const place of results) {
                const details = await new Promise((resolve, reject) => {
                  service.getDetails(
                    {
                      placeId: place.place_id,
                      fields: ["name", "formatted_address", "geometry.location", "reviews", "rating", "types", "website", "editorial_summary", "price_level", "opening_hours"],
                    },
                    (placeDetails, placeStatus) => {
                      if (placeStatus === google.maps.places.PlacesServiceStatus.OK) {
                        resolve(placeDetails);
                      } else {
                        reject(placeStatus);
                      }
                    }
                  );
                });

                const restaurant = {
                  name: details.name,
                  address: details.formatted_address,
                  location: details.geometry.location,
                  reviews: details.reviews,
                  rating: details.rating,
                  types: details.types,
                  website: details.website,
                  url: details.url,
                  editorial_summary: details.editorial_summary,
                  price_level: details.price_level,
                  opening_hours: details.opening_hours


                };
                restaurants.push(restaurant);






                const marker = new google.maps.Marker({
                  position: restaurant.location,
                  map: map,
                  title: restaurant.name,



                });





                const infowindow2 = new google.maps.InfoWindow({
                  content: `<strong>${restaurant.name}</strong><br>${restaurant.address}<br><a href="${restaurant.website}" target="_blank">Visit Website</a>`,
                });

                marker.addListener("click", () => {


                  if (reviewCount > 0) {
                    oldLayout();
                  }
                  // blue1.style.display = "block";
                  // map.classList.remove("col-12")
                  // map.classList.add("col-6");
                  map2.className = "col-6";
                  // map.style.width= "5000px";
                  blue1.style.display = "block";
                  yellow1.style.display = "block";


                  // 

                  var imageContainers = document.getElementsByClassName("image-box");
                  for (var i = 0; i < imageContainers.length; i++) {
                    imageContainers[i].style.display = "none";
                  }


                  fetchRecipes();
                  const name = restaurant.name;
                  document.getElementById("restaurantName").innerHTML = name;

                  var rating = restaurant.rating;

                  stars(rating);

                  var price_level = restaurant.price_level;
                  var price_level1 = "";

                  if (price_level == 1) {
                    price_level1 = "$ ~ Inexpensive";
                  } else if (price_level == 2) {
                    price_level1 = "$$ ~ Moderate";
                  } else if (price_level == 3) {
                    price_level1 = "$$$ ~ Expensive";
                  } else if (price_level == 4) {
                    price_level1 = "$$$$ ~ Very Expensive";
                  }




                  // const container = document.getElementById("imageContainer");
                  // const numberOfImages = rating ;

                  // const imageWidth = 15;   
                  // const imageHeight = 15;  

                  // for (let i = 0; i < Math.round(numberOfImages); i++) {


                  //     const imageBox = document.createElement("div");
                  //     imageBox.className = "image-box";

                  //     const image = document.createElement("img");
                  //     image.src = "star.png";
                  //     image.alt = "Image " + (i + 1);
                  //     image.style.width = imageWidth + "px";
                  //     image.style.height = imageHeight + "px";

                  //     imageBox.appendChild(image);
                  //     container.appendChild(imageBox);

                  //     numberOfImages = 0;


                  // }









                  document.getElementById("restaurantScore").innerHTML = rating;
                  // document.getElementById("restaurantScore").innerHTML = price_level1 ;




                  var types = restaurant.types;
                  types = types[0];
                  types = types[0].toUpperCase() + types.substring(1);

                  document.getElementById("restaurantType").innerHTML = types + " Place";

                  const address = restaurant.address;

                  document.getElementById("address").innerHTML = address;

                  const opening_hours = restaurant.opening_hours['weekday_text'];



                  // console.log("first", opening_hours);

                  let weekday1 = "";

                  for (let i = 0; i < opening_hours.length; i++) {
                    if (opening_hours[i] != ",") {
                      weekday1 = weekday1 + opening_hours[i] + "<br>";
                      // console.log(weekday1);
                    }
                  }



                  document.getElementById("OpeningHours").innerHTML = "Opening Hours: <br> " + weekday1;
                  //  console.log("This is a line." + "<br>" + "This is another line.");
                  // document.getElementById("OpeningHours").innerHTML =  opening_hours  ;






















                  const website = restaurant.website;

                  // const link = document.getElementById("website");

                  // link.setAttribute("href", website);



                  document.getElementById("website").innerHTML = website;



                  // document.getElementById("Reviews").innerHTML =reviews;

                  // const change = state2();

                  // if (change)
                  // {
                  //   newLayout(reviews);
                  // }





                  //Reviews
                  // for (let i = 0; i < 5; i++) {
                  //     console.log(`Author: `, reviews[i]['author_name'] + "\n " + `Reviews: `, reviews[i]['text'] + "\n " +  "rating:  " + reviews[i]['rating'] + "\n " + "Visited:  "  + reviews[i]['relative_time_description'] );
                  //    }





                  const reviews = restaurant.reviews;
                  var reviews2 = document.getElementById("reviews");
                  reviews2.addEventListener("click", function () {
                    reviewCount += 1;

                    newLayout(reviews, rating);
                    console.log("step1 finished");

                    marker.addEventListener("click", oldLayout);
                    console.log("step2 finished");

                  });

                  // marker.addEventListener("click", oldLayout);
















                });



              }
            }
          }
        );
      }

    )
  }
}

</script>



</html>